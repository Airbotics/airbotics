generator client {
    provider            = "prisma-client-js"
    previewFeatures     = ["interactiveTransactions"]
}

datasource db {
    provider            = "postgresql"
    url                 = env("POSTGRES_CONN_STR")
}

enum ObjectStatus {
    uploading
    uploaded
}

// namespace to contain all resources (metadata, ecus, manifests, images, etc.) related to the same project
model Namespace {
    id                  String          @id @default(uuid()) @unique

    created_at          DateTime        @default(now())
    updated_at          DateTime        @updatedAt

    refs                Ref[]
    objects             Object[]

    @@map("namespaces")
}


// ostree references
model Ref {
    name                String
    commit              String
    namespace_id        String
    object_id           String

    created_at          DateTime        @default(now())
    updated_at          DateTime        @updatedAt

    object              Object          @relation(fields: [namespace_id, object_id], references: [namespace_id, object_id], onDelete: Cascade)
    namespace           Namespace       @relation(fields: [namespace_id], references: [id], onDelete: Cascade)

    @@id([namespace_id, name])
    @@map("refs")
}

// ostree object
model Object {
    object_id           String
    namespace_id        String
    size                BigInt
    status              ObjectStatus

    created_at          DateTime        @default(now())
    updated_at          DateTime        @updatedAt

    refs                Ref[]
    namespace           Namespace       @relation(fields: [namespace_id], references: [id], onDelete: Cascade)

    @@id([namespace_id, object_id])
    @@map("objects")
}